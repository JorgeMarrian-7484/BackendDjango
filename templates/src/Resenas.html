{% extends 'index.html' %}
{% block contenido %}

{% if messages %}
    
    {% for msj in messages %}
        <script>
            Swal.fire('{{ msj }}','','success').then(()=>{
                window.location.href = '{{ ruta }}'
            })
        </script>
    {% endfor %}
        
{% endif %}

<h2 class="alert alert-dark text-center mt-3">{{ titulo }}</h2>
<div class="mt-3 text-end mb-3">
    <a href="{% url 'crearresenas' %}" class="btn btn-success">Añadir Resena</a>
</div>
{% if resena %}
<table class="table table-bordered table-hover">
    <thead class="table-dark">
        <tr>
            <th>Fuente</th>
            <th>Puntuación</th>
            <th>Fecha</th>
            <th>Descripción</th>
            <th>Acciones</th>
            <th></th>
        </tr>
    </thead>
    <tbody>        
        {% for r in resena %}
            <tr>
                <td>{{r.fuente }}</td>
                <td>{{r.puntuacion}}</td>
                <td>{{r.fecha_resena}}</td>
                <td>{{r.descripcion}}</td>
                <td class="col-2 text-center">
                    <a href="{% url 'editar_resena' r.id %}" class="btn btn-warning">Editar</a>
                    <button onclick="eliminar('{{r.id}}')" class="btn btn-danger">Eliminar</button>
                </td>
            </tr>
        {% endfor %}            
    </tbody>
</table>

<nav aria-label="Navegación de reseñas">
    <ul class="pagination justify-content-center">
        {% if resena.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page={{ resena.previous_page_number }}">Anterior</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link">Anterior</a>
        </li>
        {% endif %} 
        {% for num in resena.paginator.page_range %} 
        {% if resena.number == num %}
        <li class="page-item active">
            <a class="page-link">{{ num }}</a>
        </li>
        {% elif num > resena.number|add:'-3' and num < resena.number|add:'3' %}
        <li class="page-item ">
            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
        </li>
        {% endif %}  
        {% endfor %}
        
        {% if resena.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ resena.next_page_number }}">Siguiente</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link">Siguiente</a>
        </li>
        {% endif %}
    </ul>
</nav>

<script>
        const eliminar = (id) => {
        Swal.fire({
            title: "¿Estás seguro de eliminar registro?",
            text: "No podrás revertir los cambios",
            icon: "error",
            showCancelButton: true,
            confirmButtonColor: "#d33",
            cancelButtonColor: "#3085d6",
            confirmButtonText: "Eliminar"
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/src/resenas/eliminar/' + id
            }
        });
    }
</script>

{% else %}
<p class="alert alert-warning">No hay resenas registradas</p>
{% endif %}
<a href="{% url 'inicio' %}" class="btn btn-outline-dark">Volver</a>
{% endblock %}